name: Create JSON file

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get repository contents
      run: |
        REPO_CONTENTS=$(curl -s -H "Accept: application/vnd.github+json" https://api.github.com/repos/${{ github.repository }}/contents)

    - name: Create JSON file
      run: |
        echo $REPO_CONTENTS
        echo '{' > files.json
        FILES=$(echo $REPO_CONTENTS | jq '.[].name' -r)
        for FILE in $FILES; do
          echo $FILE
          echo '"'$FILE'": {' >> files.json
          echo '  "type": "file",' >> files.json
          echo '  "url": "https://github.com/'${{ github.repository }}'/blob/'${{ github.sha }}'/'$FILE'"' >> files.json
          echo '},' >> files.json
        done
        sed -i '$ s/.$//' files.json
        echo '}' >> files.json

    - name: Upload JSON file
      uses: actions/upload-artifact@v2
      with:
        name: files
        path: files.json
